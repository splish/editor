{"version":3,"sources":["../../src/Component/index.js"],"names":["onBlur","_event","_data","state","Slate","componentDidMount","selection","window","getSelection","updateToolbar","shouldComponentUpdate","nextProps","editorState","props","toolbar","focused","readOnly","componentDidUpdate","onStateChange","onChange","handleOpen","portal","firstChild","isBlurred","isCollapsed","left","top","width","style","opacity","scrollY","offsetHeight","scrollX","offsetWidth","onPaste","e","data","type","isShift","deserialize","html","document","transform","insertFragment","apply","schema","plugins","onKeyDown","HoverButtons","ToolbarButtons","focus","isOpened","isExpanded","isFocused","padding","Boolean"],"mappings":"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","file":"index.js","sourcesContent":["/*\n * This file is part of ORY Editor.\n *\n * ORY Editor is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *  \n * ORY Editor is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *  \n * You should have received a copy of the GNU Lesser General Public License\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license LGPL-3.0\n * @copyright 2016-2018 Aeneas Rekkas\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\n *\n */\n\n/* eslint-disable no-alert, prefer-reflect, no-underscore-dangle */\nimport getMuiTheme from 'material-ui/styles/getMuiTheme'\nimport darkBaseTheme from 'material-ui/styles/baseThemes/darkBaseTheme'\nimport MuiThemeProvider from 'material-ui/styles/MuiThemeProvider'\nimport React, { Component } from 'react'\nimport Portal from 'react-portal'\nimport position from 'selection-position'\nimport { Editor } from 'slate'\nimport BottomToolbar from 'ory-editor-ui/lib/BottomToolbar'\nimport { ContentPluginProps } from 'ory-editor-core/lib/service/plugin/classes'\n\nimport { html as serializer } from '../hooks.js'\n\nconst onBlur = (_event, _data, state) => state\n\nexport type Props = ContentPluginProps<{ editorState: Object }>\n\nclass Slate extends Component {\n  componentDidMount = () => {\n    this.selection = window.getSelection()\n    this.updateToolbar()\n  }\n\n  shouldComponentUpdate = nextProps =>\n    nextProps.state.editorState !== this.props.state.editorState ||\n    nextProps.state.toolbar !== this.props.state.toolbar ||\n    nextProps.focused !== this.props.focused ||\n    nextProps.readOnly !== this.props.readOnly\n\n  componentDidUpdate = () => this.updateToolbar()\n\n  props: ContentPluginProps<{ editorState: Object }>\n  portal: any\n\n  onStateChange = editorState => {\n    this.props.onChange({ editorState })\n  }\n\n  handleOpen = portal => {\n    this.toolbar = portal.firstChild\n  }\n\n  updateToolbar = () => {\n    const { editorState } = this.props.state\n    const toolbar = this.toolbar\n\n    if (!toolbar || editorState.isBlurred || editorState.isCollapsed) {\n      return\n    }\n\n    const { left, top, width } = position()\n\n    toolbar.style.opacity = 1\n    toolbar.style.top = `${top + window.scrollY - toolbar.offsetHeight}px`\n    toolbar.style.left = `${left +\n      window.scrollX -\n      toolbar.offsetWidth / 2 +\n      width / 2}px`\n  }\n\n  onPaste = (e, data, state) => {\n    if (data.type != 'html') return\n    if (data.isShift) return\n\n    const { document } = serializer.deserialize(data.html)\n\n    return state\n      .transform()\n      .insertFragment(document)\n      .apply()\n  }\n\n  render() {\n    const {\n      focused,\n      readOnly,\n      state: { editorState },\n      schema,\n      plugins,\n      onKeyDown,\n      HoverButtons,\n      ToolbarButtons,\n      focus\n    } = this.props\n    const isOpened = editorState.isExpanded && editorState.isFocused\n\n    return (\n      <div>\n        <Portal isOpened={isOpened} onOpen={this.handleOpen}>\n          <MuiThemeProvider muiTheme={getMuiTheme(darkBaseTheme)}>\n            {/* ory-prevent-blur is required to prevent global blurring */}\n            <div\n              className=\"ory-prevent-blur ory-plugins-content-slate-inline-toolbar\"\n              style={{ padding: 0 }}\n            >\n              <HoverButtons\n                editorState={editorState}\n                onChange={this.onStateChange}\n                focus={focus}\n              />\n            </div>\n          </MuiThemeProvider>\n        </Portal>\n        <Editor\n          onChange={this.onStateChange}\n          onKeyDown={onKeyDown}\n          readOnly={Boolean(readOnly)}\n          className=\"ory-plugins-content-slate-container\"\n          onBlur={onBlur}\n          schema={schema}\n          state={editorState}\n          plugins={plugins}\n          onPaste={this.onPaste}\n        />\n        {readOnly ? null : (\n          <BottomToolbar open={focused}>\n            <ToolbarButtons\n              editorState={editorState}\n              onChange={this.onStateChange}\n              focus={focus}\n            />\n          </BottomToolbar>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Slate\n"]}