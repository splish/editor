{"version":3,"sources":["../src/hooks.js"],"names":["DEFAULT_NODE","defaultPlugins","lineBreakSerializer","deserialize","el","tagName","toLowerCase","kind","text","serialize","object","children","type","html","rules","parseHtml","parseFragment","options","terse","createInitialState","editorState","nodes","unserialize","importFromHtml","serialized","merge","states","mergedNodes","a","b","concat","mergedDocument","create","mergedEditorState","document","split","state","map","node","splittedDocument","splittedEditorState","toArray","handleRemoveHotKey","_","content","Promise","resolve","reject","length","windowSelectionWaitTime","handleFocusPreviousHotKey","e","isExpanded","setTimeout","selection","isAtStartOf","first","handleFocusNextHotKey","isAtEndOf","last"],"mappings":"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","file":"hooks.js","sourcesContent":["/*\n * This file is part of ORY Editor.\n *\n * ORY Editor is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *  \n * ORY Editor is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *  \n * You should have received a copy of the GNU Lesser General Public License\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license LGPL-3.0\n * @copyright 2016-2018 Aeneas Rekkas\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\n *\n */\n\n// @flow\n// FIXME #125: missing types for slate internals\n/* eslint-disable new-cap, arrow-body-style, react/display-name */\nimport { List } from 'immutable'\nimport head from 'ramda/src/head'\nimport map from 'ramda/src/map'\nimport path from 'ramda/src/path'\nimport reduce from 'ramda/src/reduce'\nimport tail from 'ramda/src/tail'\nimport React from 'react'\nimport type { Props } from './Component'\nimport AlignmentPlugin from './plugins/alignment'\nimport BlockquotePlugin from './plugins/blockquote'\nimport CodePlugin from './plugins/code'\nimport EmphasizePlugin from './plugins/emphasize'\nimport HeadingsPlugin from './plugins/headings'\nimport LinkPlugin from './plugins/link'\nimport ListsPlugin from './plugins/lists'\nimport ParagraphPlugin, { P } from './plugins/paragraph'\nimport parse5 from 'parse5'\n\n// FIXME #126\nimport { Document, Html, Raw, State, Plain } from 'slate'\n\nconst DEFAULT_NODE = P\n\nexport const defaultPlugins = [\n  new ParagraphPlugin(),\n  new EmphasizePlugin(),\n  new HeadingsPlugin({ DEFAULT_NODE }),\n  new LinkPlugin(),\n  new CodePlugin({ DEFAULT_NODE }),\n  new ListsPlugin({ DEFAULT_NODE }),\n  new BlockquotePlugin({ DEFAULT_NODE }),\n  new AlignmentPlugin()\n  // new KatexPlugin({ DEFAULT_NODE })\n]\n\nexport const lineBreakSerializer = {\n  deserialize(el: any) {\n    if (el.tagName.toLowerCase() === 'br') {\n      return { kind: 'text', text: '\\n' }\n    }\n  },\n  serialize(object: any, children: any) {\n    if (object.type === 'text' || children === '\\n') {\n      return <br />\n    }\n  }\n}\n\nexport const html = new Html({\n  rules: [...defaultPlugins, lineBreakSerializer],\n  parseHtml: parse5.parseFragment\n})\n\nconst options = { terse: true }\n\nexport const createInitialState = () => ({\n  editorState: Raw.deserialize(\n    {\n      nodes: [\n        {\n          kind: 'block',\n          type: P,\n          nodes: [\n            {\n              kind: 'text',\n              text: ''\n            }\n          ]\n        }\n      ]\n    },\n    options\n  )\n})\n\nexport const unserialize = ({\n  importFromHtml,\n  serialized,\n  editorState\n}: {\n  importFromHtml: string,\n  serialized: Object,\n  editorState: Object\n}): { editorState: Object } => {\n  if (serialized) {\n    return { editorState: Raw.deserialize(serialized, options) }\n  } else if (importFromHtml) {\n    return { editorState: html.deserialize(importFromHtml, options) }\n  } else if (editorState) {\n    return { editorState }\n  }\n\n  return createInitialState()\n}\n\nexport const serialize = ({ editorState }: any) => ({\n  serialized: Raw.serialize(editorState, options)\n})\n\nexport const merge = (states: Object[]): Object => {\n  const nodes = map(path(['editorState', 'document', 'nodes']), states)\n  const mergedNodes = reduce(\n    (a: List<any>, b: List<any>) => a.concat(b),\n    head(nodes),\n    tail(nodes)\n  )\n  const mergedDocument = Document.create({ nodes: mergedNodes })\n  const mergedEditorState = State.create({ document: mergedDocument })\n\n  return { editorState: mergedEditorState }\n}\n\nexport const split = (state: Object): Object[] => {\n  const nodes = path(['editorState', 'document', 'nodes'], state)\n\n  return nodes\n    .map((node: any) => {\n      const splittedDocument = Document.create({ nodes: List([node]) })\n      const splittedEditorState = State.create({ document: splittedDocument })\n\n      return { editorState: splittedEditorState }\n    })\n    .toArray()\n}\n\n// const position = (): {\n//   top: ?number,\n//   right: ?number,\n//   left: ?number,\n//   bottom: ?number\n// } => {\n//   if (window && window.getSelection) {\n//     const selection = window.getSelection()\n//     if (!selection.rangeCount) {\n//       return {\n//         top: null,\n//         right: null,\n//         left: null,\n//         bottom: null,\n//       }\n//     }\n//\n//     return selection.getRangeAt(0).getBoundingClientRect()\n//   }\n//\n//   if (window.document.selection) {\n//     return window.document.selection\n//       .createRange()\n//       .getBoundingClientRect()\n//   }\n//\n//   return {\n//     top: null,\n//     right: null,\n//     left: null,\n//     bottom: null,\n//   }\n// }\n\n// if editor state is empty, remove cell when backspace or delete was pressed.\nexport const handleRemoveHotKey = (\n  _: KeyboardEvent,\n  { content: { state: { editorState } } }: Props\n) =>\n  new Promise(\n    (resolve: Function, reject: Function) =>\n      Plain.serialize(editorState).length < 1 ? resolve() : reject()\n  )\n\nconst windowSelectionWaitTime = 1\n\nexport const handleFocusPreviousHotKey = (\n  e: KeyboardEvent,\n  { content: { state: { editorState } } }: Props\n) => {\n  // const isArrowUp = e.keyCode === 38\n\n  return new Promise((resolve: Function, reject: Function) => {\n    if (editorState.isExpanded) {\n      return reject()\n    }\n\n    setTimeout(() => {\n      // if (isArrowUp && next.top === current.top) {\n      //   return resolve()\n      // } else\n      if (\n        editorState.selection.isAtStartOf(editorState.document.nodes.first())\n      ) {\n        return resolve()\n      }\n      reject()\n    }, windowSelectionWaitTime)\n  })\n}\n\nexport const handleFocusNextHotKey = (\n  e: KeyboardEvent,\n  { content: { state: { editorState } } }: Props\n) => {\n  // const isArrowDown = e.keyCode === 40\n\n  return new Promise((resolve: Function, reject: Function) => {\n    if (editorState.isExpanded) {\n      return reject()\n    }\n\n    setTimeout(() => {\n      // if (isArrowDown && next.top === current.top) {\n      //   return resolve()\n      // } else\n      if (editorState.selection.isAtEndOf(editorState.document.nodes.last())) {\n        return resolve()\n      }\n      reject()\n    }, windowSelectionWaitTime)\n  })\n}\n"]}