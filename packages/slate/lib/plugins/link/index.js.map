{"version":3,"sources":["../../../src/plugins/link/index.js"],"names":["A","Button","state","open","href","title","hadLinks","onRef","component","e","querySelector","focus","onClick","props","editorState","onChange","preventDefault","hasLinks","inlines","some","inline","type","newState","transform","unwrapInline","apply","isExpanded","setState","wasExpanded","handleClose","window","setTimeout","handleSubmit","wrapInline","data","collapseToEnd","insertText","extend","length","onHrefChange","target","value","onTitleChange","actions","LinkPlugin","name","nodes","hoverButtons","toolbarButtons","deserialize","el","next","tagName","toLowerCase","kind","childNodes","create","attrs","find","serialize","object","children","get"],"mappings":"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","file":"index.js","sourcesContent":["/*\n * This file is part of ORY Editor.\n *\n * ORY Editor is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *  \n * ORY Editor is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Lesser General Public License for more details.\n *  \n * You should have received a copy of the GNU Lesser General Public License\n * along with ORY Editor.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license LGPL-3.0\n * @copyright 2016-2018 Aeneas Rekkas\n * @author Aeneas Rekkas <aeneas+oss@aeneas.io>\n *\n */\n\n/* eslint-disable no-alert, prefer-reflect, default-case, react/display-name */\nimport LinkIcon from 'material-ui/svg-icons/content/link'\nimport React, { Component } from 'react'\nimport getMuiTheme from 'material-ui/styles/getMuiTheme'\nimport MuiThemeProvider from 'material-ui/styles/MuiThemeProvider'\nimport TextField from 'material-ui/TextField'\nimport { ToolbarButton } from '../../helpers'\nimport Plugin from '../Plugin'\nimport Link from './node'\nimport Dialog from 'material-ui/Dialog'\nimport FlatButton from 'material-ui/FlatButton'\nimport { Data } from 'slate'\nimport type { Props } from '../props'\n\nexport const A = 'LINK/LINK'\n\nclass Button extends Component {\n  state = {\n    open: false,\n    href: '',\n    title: '',\n    hadLinks: false\n  }\n\n  props: Props\n\n  input: Component<*, *, *>\n\n  onRef = (component: Component<*, *, *>) => {\n    if (!component && true) {\n      return null\n    }\n\n    const e = component.querySelector('input')\n    if (e) {\n      e.focus()\n    }\n  }\n\n  onClick = e => {\n    const { editorState, onChange } = this.props\n    e.preventDefault()\n\n    const hasLinks = editorState.inlines.some(\n      (inline: any) => inline.type === A\n    )\n\n    if (hasLinks) {\n      const newState = editorState\n        .transform()\n        .unwrapInline(A)\n        .apply()\n      onChange(newState)\n    } else if (editorState.isExpanded) {\n      this.setState({\n        open: true,\n        wasExpanded: editorState.isExpanded,\n        href: '',\n        title: '',\n        hadLinks: hasLinks\n      })\n    } else {\n      this.setState({\n        open: true,\n        wasExpanded: editorState.isExpanded,\n        href: '',\n        title: '',\n        hadLinks: hasLinks\n      })\n    }\n  }\n\n  handleClose = () => {\n    this.setState({ open: false })\n\n    const newState = this.props.editorState\n      .transform()\n      .focus()\n      .apply()\n    window.setTimeout(() => this.props.onChange(newState), 1)\n  }\n\n  handleSubmit = () => {\n    this.setState({ open: false })\n\n    if (!this.state.href) {\n      this.handleClose()\n      return\n    }\n\n    if (this.state.wasExpanded) {\n      const newState = this.props.editorState\n        .transform()\n        .focus()\n        .apply()\n        .transform()\n        .wrapInline({\n          type: A,\n          data: { href: this.state.href }\n        })\n        .collapseToEnd()\n        .apply()\n\n      window.setTimeout(() => this.props.onChange(newState), 1)\n      window.setTimeout(() => this.props.focus(), 100)\n      return\n    }\n\n    if (!this.state.title) {\n      this.handleClose()\n      return\n    }\n\n    const newState = this.props.editorState\n      .transform()\n      .insertText(this.state.title)\n      .extend(-this.state.title.length)\n      .wrapInline({\n        type: A,\n        data: { href: this.state.href }\n      })\n      .collapseToEnd()\n      .focus()\n      .apply()\n\n    this.props.onChange(newState)\n    window.setTimeout(() => this.props.focus(), 100)\n  }\n\n  onHrefChange = e => {\n    this.setState({ href: e.target.value })\n  }\n\n  onTitleChange = e => {\n    this.setState({ title: e.target.value })\n  }\n\n  render() {\n    const actions = [\n      <FlatButton\n        key=\"0\"\n        label=\"Cancel\"\n        primary\n        onTouchTap={this.handleClose}\n      />,\n      <FlatButton\n        key=\"1\"\n        label=\"Submit\"\n        primary\n        onTouchTap={this.handleSubmit}\n      />\n    ]\n    const { editorState } = this.props\n\n    const hasLinks = editorState.inlines.some(\n      (inline: any) => inline.type === A\n    )\n    return (\n      <MuiThemeProvider muiTheme={getMuiTheme()}>\n        <span>\n          <ToolbarButton\n            onClick={this.onClick}\n            isActive={hasLinks}\n            icon={<LinkIcon />}\n          />\n          <span>\n            <Dialog\n              className=\"ory-prevent-blur\"\n              title=\"Create a link\"\n              modal={false}\n              open={this.state.open}\n              actions={[actions]}\n            >\n              {this.state.wasExpanded ? null : (\n                <div>\n                  <TextField\n                    hintText=\"Link title\"\n                    onChange={this.onTitleChange}\n                    value={this.state.title}\n                  />\n                </div>\n              )}\n              <div ref={this.onRef}>\n                <TextField\n                  hintText=\"http://example.com/my/link.html\"\n                  onChange={this.onHrefChange}\n                  value={this.state.href}\n                />\n              </div>\n            </Dialog>\n          </span>\n        </span>\n      </MuiThemeProvider>\n    )\n  }\n}\n\nexport default class LinkPlugin extends Plugin {\n  name = 'link'\n\n  nodes = { [A]: Link }\n\n  hoverButtons = [Button]\n  toolbarButtons = [Button]\n\n  deserialize = (el, next) => {\n    switch (el.tagName.toLowerCase()) {\n      case 'a':\n        return {\n          kind: 'inline',\n          type: A,\n          nodes: next(el.childNodes),\n          data: Data.create({\n            href: (el.attrs.find(({ name }) => name === 'href') || {\n              value: ''\n            }).value\n          })\n        }\n    }\n  }\n\n  serialize = (\n    object: { type: string, kind: string, data: any },\n    children: any[]\n  ) => {\n    if (object.kind !== 'inline') {\n      return\n    }\n    switch (object.type) {\n      case A:\n        return <a href={object.data.get('href')}>{children}</a>\n    }\n  }\n}\n"]}